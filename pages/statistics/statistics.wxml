<!-- pages/statistics/statistics.wxml -->
<view class="container">
  <!-- 顶部统计概览 -->
  <view class="stats-overview">
    <view class="overview-card">
      <text class="overview-value">{{averageScore||85.6}}</text>
      <text class="overview-label">平均分</text>
      <view class="trend up">↑ 2.3%</view>
    </view>
    <view class="overview-card">
      <text class="overview-value">{{excellentRate||92}}%</text>
      <text class="overview-label">优秀率</text>
      <view class="trend up">↑ 5.1%</view>
    </view>
    <view class="overview-card">
      <text class="overview-value">{{passRate||78.3}}</text>
      <text class="overview-label">及格率</text>
      <view class="trend down">↓ 1.2%</view>
    </view>
  </view>

  <!-- 图表区域 -->
  <view class="charts-section">
    <view class="section-header">
      <text class="section-title">考核分数分布</text>
    </view>
    
    <!-- 柱状图容器 -->
    <view class="chart-container">
      <view class="bar-chart">
        <view class="bar-item" wx:for="{{scoreDistribution}}" wx:key="range">
          <view class="bar-wrapper">
            <view class="bar" style="height: {{item.percentage}}%"></view>
          </view>
          <text class="bar-label">{{item.range}}</text>
          <text class="bar-value">{{item.count}}人</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 教师排名 -->
  <view class="ranking-section">
    <view class="section-header">
      <text class="section-title">教师排名</text>
      <text class="more-link" bindtap="viewAllRanking">查看全部 ></text>
    </view>
    
    <view class="ranking-list">
      <view class="ranking-item" wx:for="{{teacherRanking}}" wx:key="id">
        <view class="rank-number {{index < 3 ? 'top-' + (index + 1) : ''}}">
          {{index + 1}}
        </view>
        <view class="teacher-info">
          <text class="teacher-name">{{item.name}}</text>
          <text class="teacher-department">{{item.department}}</text>
        </view>
        <view class="score-info">
          <text class="score">{{item.score}}分</text>
          <text class="score-change {{item.change >= 0 ? 'up' : 'down'}}">
            {{item.change >= 0 ? '↑' : '↓'}} {{Math.abs(item.change)}}
          </text>
        </view>
      </view>
    </view>
  </view>

  <!-- 考核项目分析 -->
  <view class="analysis-section">
    <view class="section-header">
      <text class="section-title">考核项目分析</text>
    </view>
    
    <view class="analysis-list">
      <view class="analysis-item" wx:for="{{itemAnalysis}}" wx:key="name">
        <view class="item-header">
          <text class="item-name">{{item.name}}</text>
          <text class="item-score">{{item.averageScore != null? item.averageScore:0}}分</text>
        </view>
        <view class="progress-bar">
          <view class="progress" style="width: {{item.percentage}}%"></view>
        </view>
        <view class="item-footer">
          <text class="item-label">平均分</text>
          <text class="item-trend {{item.trend >= 0 ? 'up' : 'down'}}">
            {{item.trend >= 0 ? '↑' : '↓'}} {{Math.abs(item.trend)}}%
          </text>
        </view>
      </view>
    </view>
  </view>

  <!-- 完成情况 -->
  <view class="completion-section">
    <view class="section-header">
      <text class="section-title">完成情况</text>
    </view>
    <view class="completion-cards">
      <view class="completion-card total">
        <text class="completion-value">{{completionStatus.total}}</text>
        <text class="completion-label">总人数</text>
      </view>
      <view class="completion-card pending">
        <text class="completion-value">{{completionStatus.pending}}</text>
        <text class="completion-label">未开始</text>
      </view>
      <view class="completion-card in-progress">
        <text class="completion-value">{{completionStatus.progress}}</text>
        <text class="completion-label">进行中</text>
      </view>
      <view class="completion-card completed">
        <text class="completion-value">{{completionStatus.completed}}</text>
        <text class="completion-label">已完成</text>
      </view>
    </view>
  </view>
</view>