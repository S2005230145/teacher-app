<!-- pages/kpi/kpi.wxml -->
<view class="container">
  <!-- é¡¶éƒ¨ç­›é€‰å’Œæœç´¢ -->
  <view class="header-section">
    <view class="search-box" style="width: 90vw;">
      <view class="search-icon">ğŸ”</view>
      <input class="search-input" placeholder="æœç´¢è€ƒæ ¸é¡¹ç›®..." bindinput="onSearchInput" />
      <view class="filter-btn" bindtap="showFilter">ç­›é€‰ â–¼</view>
    </view>
    <view class="filter-panel" wx:if="{{showFilterPanel}}">
      <view class="filter-row">
        <text class="filter-label">è€ƒæ ¸ç±»å‹:</text>
        <view class="filter-tags">
          <text class="filter-tag {{currentFilter.type === 'all' ? 'active' : ''}}" 
                bindtap="setFilter" data-type="type" data-value="all">å…¨éƒ¨</text>
          <text class="filter-tag {{currentFilter.type === 'teaching' ? 'active' : ''}}" 
                bindtap="setFilter" data-type="type" data-value="teaching">æ•™å­¦</text>
          <text class="filter-tag {{currentFilter.type === 'research' ? 'active' : ''}}" 
                bindtap="setFilter" data-type="type" data-value="research">ç§‘ç ”</text>
          <text class="filter-tag {{currentFilter.type === 'service' ? 'active' : ''}}" 
                bindtap="setFilter" data-type="type" data-value="service">æœåŠ¡</text>
        </view>
      </view>
      
      <view class="filter-row">
        <text class="filter-label">çŠ¶æ€:</text>
        <view class="filter-tags">
          <text class="filter-tag {{currentFilter.status === 'all' ? 'active' : ''}}" 
                bindtap="setFilter" data-type="status" data-value="all">å…¨éƒ¨</text>
          <text class="filter-tag {{currentFilter.status === 'active' ? 'active' : ''}}" 
                bindtap="setFilter" data-type="status" data-value="active">è¿›è¡Œä¸­</text>
          <text class="filter-tag {{currentFilter.status === 'completed' ? 'active' : ''}}" 
                bindtap="setFilter" data-type="status" data-value="completed">å·²å®Œæˆ</text>
          <text class="filter-tag {{currentFilter.status === 'pending' ? 'active' : ''}}" 
                bindtap="setFilter" data-type="status" data-value="pending">æœªå¼€å§‹</text>
        </view>
      </view>
    </view>
  </view>

  <!-- KPIç»Ÿè®¡æ¦‚è§ˆ -->
  <view class="stats-overview" style="width: 95vw;">
    <view class="stat-card">
      <text class="stat-value">{{totalKpis}}</text>
      <text class="stat-label">æ€»é¡¹ç›®æ•°</text>
    </view>
    <view class="stat-card">
      <text class="stat-value">{{completedKpis}}</text>
      <text class="stat-label">å·²å®Œæˆ</text>
    </view>
    <view class="stat-card">
      <text class="stat-value">{{completionRate}}%</text>
      <text class="stat-label">å®Œæˆç‡</text>
    </view>
    <view class="stat-card">
      <text class="stat-value">{{averageScore}}</text>
      <text class="stat-label">å¹³å‡åˆ†</text>
    </view>
  </view>

  <!-- KPIåˆ—è¡¨ -->
  <scroll-view class="kpi-list" scroll-y>
    <view class="kpi-section">
      <view class="section-header">
        <text class="section-title">è€ƒæ ¸é¡¹ç›®åˆ—è¡¨</text>
        <text class="section-count">å…±{{filteredKpis.length}}é¡¹</text>
      </view>
      
      <view class="kpi-items">
        <view class="kpi-item" wx:for="{{filteredKpis}}" wx:key="id" bindtap="viewKpiDetail" data-id="{{item.id}}">
          <view class="item-header">
            <view class="item-badge {{item.type}}">
              <text class="badge-text">{{item.typeText}}</text>
            </view>
            <view class="item-status {{item.status}}">
              <text class="status-text">{{item.statusText}}</text>
            </view>
          </view>
          
          <view class="item-content">
            <text class="kpi-name">{{item.name}}</text>
       <!--      <text class="kpi-desc">{{item.description}}</text> -->
            
            <view class="kpi-metrics">
              <view class="metric">
                <text class="metric-label">æƒé‡:</text>
                <text class="metric-value">{{item.weight}}%</text>
              </view>
              <view class="metric">
                <text class="metric-label">ç›®æ ‡å€¼:</text>
                <text class="metric-value">{{item.targetValue}}</text>
              </view>
              <view class="metric">
                <text class="metric-label">å½“å‰å€¼:</text>
                <text class="metric-value">{{item.currentValue != null? item.score:0  }}</text>
              </view>
            </view>
            
            <view class="progress-section">
              <view class="progress-info">
                <text class="progress-label">å®Œæˆè¿›åº¦</text>
                <text class="progress-percent">{{item.progress}}%</text>
              </view>
              <view class="progress-bar">
                <view class="progress-fill" style="width: {{item.progress + '%'}}"></view>
              </view>
            </view>
            
            <view class="score-section">
              <text class="score-label">å¾—åˆ†:</text>
              <text class="score-value">{{item.score != null? item.score:0}}åˆ†</text>
              <text class="score-max">/ {{item.maxScore!= null? item.maxScore:100}}åˆ†</text>
            </view>
          </view>
          
          <view class="item-footer">
            <text class="deadline">æˆªæ­¢: {{item.deadline}}</text>
            <view class="action-buttons">
              <button class="btn-detail" bindtap="viewKpiDetail" data-id="{{item.id}}">æŸ¥çœ‹è¯¦æƒ…</button>
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{filteredKpis.length === 0}}">
      <view class="empty-icon">ğŸ“Š</view>
      <text class="empty-text">æš‚æ— è€ƒæ ¸é¡¹ç›®</text>
      <text class="empty-desc">è¯·æ·»åŠ æˆ–ç­‰å¾…åˆ†é…è€ƒæ ¸é¡¹ç›®</text>
      <button class="empty-btn" bindtap="addKpi">æ·»åŠ è€ƒæ ¸é¡¹ç›®</button>
    </view>
  </scroll-view>
</view>